{{#*inline "resource"}}
<h3 class="category-header divider tooltipped">
    <span></span>
    <label>{{label}}</label>
    <div class="tooltip">{{data.tooltip}}</div>
    <span></span>
</h3>
<div class="resource-values flexrow">
    <input type="number" name="{{attr}}.value" value="{{lookup data 'value'}}" placeholder="0"
           {{#if @root.sectionLocks.resources}}disabled{{/if}}/>
    <span class="slash"></span>
    <span class="input resource-max">{{data.max}}</span>
    <div class="bar" style="background: {{data.color.bg}}">
        <div class="fill" style="width:{{data.pct}}%; background: {{data.color.fill}}"></div>
    </div>
</div>
{{/inline}}

<form class="{{cssClass}} flexrow" autocomplete="off">

    {{!-- Left Sidebar --}}
    <section class="sheet-sidebar flexcol">
        <img class="profile" src="{{data.img}}" title="{{data.name}}" data-edit="img" width="200" height="200"/>
        <section class="overview">

            {{!-- Current Equipment --}}
            <div class="equipped">
                <h2 class="section-header divider"><span></span><label>Current Equipment</label><span></span></h2>
                <div class="equipment flexrow">
                    <img src="{{actor.equipment.weapons.mainhand.img}}" height="24" width="24"/>
                    <h4>{{actor.equipment.weapons.mainhand.name}}</h4>
                    <span class="tag">{{mainhandTag}}</span>
                </div>
                {{#if showOffhand}}
                <div class="equipment flexrow">
                    <img src="{{actor.equipment.weapons.offhand.img}}" height="24" width="24"/>
                    <h4>{{actor.equipment.weapons.offhand.name}}</h4>
                    <span class="tag">{{offhandTag}}</span>
                </div>
                {{/if}}
                <div class="equipment flexrow">
                    <img src="{{actor.equipment.armor.img}}" height="24" width="24"/>
                    <h4>{{actor.equipment.armor.name}}</h4>
                    <span class="tag">{{armorTag}}</span>
                </div>
            </div>

            {{!-- Available Actions --}}
            <div class="actions">
                <h2 class="section-header divider"><span></span><label>Available Actions</label><span></span></h2>
                {{#each actions}}
                <div class="action flexrow" data-action-id="{{this.id}}">
                    <img src="{{this.img}}" height="24" width="24"/>
                    <h4><a class="control" title="Use {{this.name}}" data-action="useAction">{{this.name}}</a></h4>
                    {{#each this.tags}}
                    <span class="tag">{{this}}</span>
                    {{/each}}
                </div>
                {{/each}}
            </div>

            {{!-- Active Effects --}}
            <div class="effects">
                <h2 class="section-header divider"><span></span><label>Active Effects</label><span></span></h2>
                <div class="effect flexrow">
                    <img src="systems/crucible/icons/skills/arcana.jpg" height="24" width="24"/>
                    <h4>Effect #1</h4>
                    <span class="tag">2R</span>
                </div>
                <div class="effect flexrow">
                    <img src="systems/crucible/icons/skills/arcana.jpg" height="24" width="24"/>
                    <h4>Effect #2</h4>
                    <span class="tag">1R</span>
                </div>
            </div>
        </section>
    </section>

    {{!-- Main Content --}}
    <section class="sheet-body flexcol">

        {{!-- Sheet Header --}}
        <header class="sheet-header flexrow">
            <div class="header-content">
                <div class="title flexrow">
                    <h1 class="charname">
                        <input name="name" type="text" value="{{actor.name}}" placeholder="Actor Name"/>
                    </h1>
                    <div class="advancement flexrow">
                        <div class="bar"><div class="fill" style="width:{{systemData.advancement.pct}}%"></div></div>
                        <input type="number" name="system.advancement.progress" value="{{systemData.advancement.progress}}"/>
                        <span class="slash"></span>
                        <span class="input">{{systemData.advancement.next}}</span>
                    </div>
                    <h2 class="level {{#if incomplete.level}}tooltipped{{/if}}">
                        <label>Level</label>
                        {{#if incomplete.level}}
                        <i class="incomplete fas fa-exclamation-triangle"></i>
                        {{/if}}
                        {{#if incomplete.levelOne}}
                        <div class="tooltip right">{{localize "WALKTHROUGH.LevelOne"}}</div>
                        {{/if}}
                        {{#if incomplete.levelUp}}
                        <div class="tooltip right">{{localize "WALKTHROUGH.LevelUp"}}</div>
                        {{/if}}
                        <input type="number" name="system.advancement.level" value="{{systemData.advancement.level}}" placeholder="1"/>
                    </h2>
                </div>

                <div class="subtitle flexrow">
                    <h2 class="ancestry tag {{#if incomplete.ancestry}}inactive tooltipped{{/if}}">
                        {{systemData.details.ancestry.name}}
                        {{#if incomplete.ancestry}}
                        <i class="incomplete fas fa-exclamation-triangle"></i>
                        <div class="tooltip left">{{localize "WALKTHROUGH.AddAncestry"}}</div>
                        {{/if}}
                    </h2>
                    <h2 class="background tag {{#if incomplete.background}}inactive tooltipped{{/if}}">
                        {{systemData.details.background.name}}
                        {{#if incomplete.background}}
                        <i class="incomplete fas fa-exclamation-triangle"></i>
                        <div class="tooltip left">{{localize "WALKTHROUGH.AddBackground"}}</div>
                        {{/if}}
                    </h2>
                </div>
            </div>
        </header>

        {{!-- Sheet Navigation --}}
        <nav class="sheet-navigation tabs" data-group="primary">
            <a class="item badge attributes {{#if incomplete.abilities}}tooltipped{{/if}}" data-tab="attributes">Attributes
            {{~#if incomplete.abilities~}}
            <i class="incomplete fas fa-exclamation-triangle"></i>
            <div class="tooltip">{{localize "WALKTHROUGH.AbilityPoints"}}</div>
            {{/if}}</a>
            <a class="item badge skills {{#if incomplete.skills}}tooltipped{{/if}}" data-tab="skills">Skills
            {{~#if incomplete.skills~}}
            <i class="incomplete fas fa-exclamation-triangle"></i>
            <div class="tooltip">{{localize "WALKTHROUGH.SkillPoints"}}</div>
            {{/if}}</a>
            <a class="item badge talents {{#if incomplete.talents}}tooltipped{{/if}}" data-tab="talents">Talents
            {{~#if incomplete.talents~}}
            <i class="incomplete fas fa-exclamation-triangle"></i>
            <div class="tooltip center">{{localize "WALKTHROUGH.TalentPoints"}}</div>
            {{/if}}</a>
            <a class="item badge inventory" data-tab="inventory">Inventory</a>
            <a class="item badge spells" data-tab="spells">Grimoire</a>
            <a class="item badge biography" data-tab="biography">Biography</a>
        </nav>

        {{!-- Attributes Tab --}}
        <div class="tab attributes flexcol" data-group="primary" data-tab="attributes">

            {{!-- Character Resources --}}
            <section class="resources flexrow">
                <h2 class="section-header divider">
                    <span></span><label>Resources</label><span></span>
                    <a class="button section-lock" data-section="resources">
                        <i class="fas {{#if sectionLocks.resources}}fa-lock{{else}}fa-unlock{{/if}}"></i>
                    </a>
                </h2>
                <div class="resource health">
                    {{> resource label="Health" attr="system.attributes.health" data=systemData.attributes.health}}
                    {{> resource label="Wounds" attr="system.attributes.wounds" data=systemData.attributes.wounds}}
                </div>

                <div class="resource morale">
                    {{> resource label="Morale" attr="system.attributes.morale" data=systemData.attributes.morale}}
                    {{> resource label="Madness" attr="system.attributes.madness" data=systemData.attributes.madness}}
                </div>

                <div class="resource action">
                    {{> resource label="Action" attr="system.attributes.action" data=systemData.attributes.action}}
                    {{> resource label="Focus" attr="system.attributes.focus" data=systemData.attributes.focus}}
                </div>
            </section>

            {{!-- Abilities --}}
            <section class="abilities">
                <h2 class="section-header divider">
                    <span></span>
                    <label>Abilities</label>
                    <span></span>
                    <a class="button section-lock" data-section="abilities">
                        <i class="fas {{#if sectionLocks.abilities}}fa-lock{{else}}fa-unlock{{/if}}"></i>
                    </a>
                </h2>
                {{#unless sectionLocks.abilities}}
                <div class="point-pools flexrow">
                    {{#if isL0}}
                    <label>Pool Size</label>
                    <span class="value highlight">36</span>
                    <label>Spent</label>
                    <span class="value highlight">{{points.ability.bought}}</span>
                    <label>Available</label>
                    <span class="value highlight">{{points.ability.pool}}</span>
                    {{else}}
                    <label>Total Points</label>
                    <span class="value highlight">{{points.ability.total}}</span>
                    <label>Spent</label>
                    <span class="value highlight">{{points.ability.spent}}</span>
                    <label>Available</label>
                    <span class="value highlight">{{points.ability.available}}</span>
                    {{/if}}
                </div>
                {{/unless}}
                <ol class="ability-scores">
                {{#each abilityScores as |attr|}}
                    <li class="ability flexrow" data-ability="{{attr.id}}">
                        <h4 class="label badge {{attr.id}}">{{attr.label}}</h4>
                        {{#unless ../sectionLocks.abilities}}
                        <div class="controls flexcol">
                            <a class="control {{#unless attr.canIncrease}}inactive{{/unless}} increase" title="Ability Increase" data-action="abilityIncrease">
                                <i class="fas fa-caret-up"></i>
                            </a>
                            <a class="control {{#unless attr.canDecrease}}inactive{{/unless}} decrease" title="Ability Decrease" data-action="abilityDecrease">
                                <i class="fas fa-caret-down"></i>
                            </a>
                        </div>
                        {{/unless}}
                        <span class="input score">{{attr.value}}</span>
                    </li>
                {{/each}}
                </ol>
            </section>

            {{!-- Defenses --}}
            <section class="defenses">
                <h2 class="section-header divider">
                    <span></span>
                    <label>Defenses</label>
                    <span></span>
                    <a class="button section-lock" data-section="defenses">
                        <i class="fas {{#if sectionLocks.defenses}}fa-lock{{else}}fa-unlock{{/if}}"></i>
                    </a>
                </h2>

                {{! Physical Defense --}}
                <ol class="defense physical flexrow" data-defense="physical">
                    <li class="defense-title flexrow">
                        <h3 class="badge physical">Physical</h3>
                        <span class="input score">{{systemData.defenses.physical}}</span>
                    </li>
                    <li class="math">=</li>
                    <li class="flexcol">
                        <h4>Armor</h4>
                        <span class="input score">{{systemData.defenses.armor.total}}</span>
                        <span class="subtitle">{{armorCategory}}</span>
                    </li>
                    <li class="math">+</li>
                    <li class="flexcol">
                        <h4>Dodge</h4>
                        <span class="input score">{{systemData.defenses.dodge.total}}</span>
                        <span class="subtitle">Maximum {{systemData.defenses.dodge.max}}</span>
                    </li>
                    <li class="math">+</li>
                    <li class="flexcol">
                        <h4>Parry</h4>
                        <span class="input score">{{systemData.defenses.parry.total}}</span>
                        <span class="subtitle">Maximum 6</span>
                    </li>
                    <li class="math">+</li>
                    <li class="flexcol">
                        <h4>Block</h4>
                        <span class="input score">{{systemData.defenses.block.total}}</span>
                        <span class="subtitle">Maximum 6</span>
                    </li>
                </ol>

                {{! Fortitude Defense --}}
                <ol class="defense save flexrow" data-defense="fortitude">
                    <li class="defense-title flexrow">
                        <h3 class="badge fortitude">Fortitude</h3>
                        <span class="input score">{{systemData.defenses.fortitude.total}}</span>
                    </li>
                    <li class="math">=</li>
                    <li class="flexrow base">
                        <span class="input score">{{systemData.defenses.fortitude.base}}</span>
                    </li>
                    <li class="math">+</li>
                    <li class="flexrow bonus">
                        <input type="number" name="system.defenses.fortitude.bonus" value="{{systemData.defenses.fortitude.bonus}}" {{#if sectionLocks.defenses}}disabled{{/if}}/>
                    </li>
                    <li class="tags">
                        <span class="tag">Str</span>
                        <span class="tag">Con</span>
                    </li>
                </ol>

                {{! Reflex Defense --}}
                <ol class="defense save flexrow" data-defense="reflex">
                    <li class="defense-title flexrow">
                        <h3 class="badge reflex">Reflex</h3>
                        <span class="input score">{{systemData.defenses.reflex.total}}</span>
                    </li>
                    <li class="math">=</li>
                    <li class="flexrow base">
                        <span class="input score">{{systemData.defenses.reflex.base}}</span>
                    </li>
                    <li class="math">+</li>
                    <li class="flexrow bonus">
                        <input type="number" name="system.defenses.reflex.bonus" value="{{systemData.defenses.reflex.bonus}}" {{#if sectionLocks.defenses}}disabled{{/if}}/>
                    </li>
                    <li class="tags">
                        <span class="tag">Dex</span>
                        <span class="tag">Int</span>
                    </li>
                </ol>

                {{! Willpower Defense --}}
                <ol class="defense save flexrow" data-defense="willpower">
                    <li class="defense-title flexrow">
                        <h3 class="badge willpower">Willpower</h3>
                        <span class="input score">{{systemData.defenses.willpower.total}}</span>
                    </li>
                    <li class="math">=</li>
                    <li class="flexrow base">
                        <span class="input score">{{systemData.defenses.willpower.base}}</span>
                    </li>
                    <li class="math">+</li>
                    <li class="flexrow bonus">
                        <input type="number" name="system.defenses.willpower.bonus" value="{{systemData.defenses.willpower.bonus}}" {{#if sectionLocks.defenses}}disabled{{/if}}/>
                    </li>
                    <li class="tags">
                        <span class="tag">Wis</span>
                        <span class="tag">Pre</span>
                    </li>
                </ol>
            </section>

            {{!-- Resistances --}}
            <section class="damage-resistances flexrow">
                <h2 class="section-header divider">
                    <span></span>
                    <label>Resistances</label>
                    <span></span>
                    <a class="button section-lock" data-section="resistances">
                        <i class="fas {{#if sectionLocks.resistances}}fa-lock{{else}}fa-unlock{{/if}}"></i>
                    </a>
                </h2>
                {{#each resistances as |res cat|}}
                <div class="category {{cat}}">
                    <h3 class="category-header divider">
                        <span></span>
                        <label>{{res.label}}</label>
                        <span></span>
                    </h3>
                    <ol class="resistances {{cat}}" data-resistance-type="{{cat}}">
                        {{#each res.resists as |r id|}}
                        <li class="resistance flexrow" data-resistance="{{id}}">
                            <span class="input total">{{r.total}}</span>
                            <label>{{r.label}}</label>
                            <span class="base">{{r.base}}</span>
                            <span class="math">+</span>
                            <input type="number" name="system.resistances.{{id}}.bonus" value="{{r.bonus}}"
                               {{#if @root.sectionLocks.resistances}}disabled{{/if}}/>
                        </li>
                        {{/each}}
                    </ol>
                </div>
                {{/each}}
            </section>
        </div>

        {{!-- Skills Tab --}}
        <div class="tab skills flexcol" data-group="primary" data-tab="skills">
            <div class="point-pools flexrow">
                <label>Total Points</label>
                <span class="value highlight">{{points.skill.total}}</span>
                <label>Spent</label>
                <span class="value highlight">{{points.skill.spent}}</span>
                <label>Available</label>
                <span class="value highlight">{{points.skill.available}}</span>
            </div>

            {{!-- Skills List --}}
            {{#each skillCategories as |category catId|}}
            <header class="items-header flexrow">
                <div class="item-name skill-name">
                    <h4>{{category.label}} Skills</h4>
                </div>
                <div class="bonus">Bonus</div>
                <div class="attributes">Attributes</div>
                <span>Trained Rank</span>
                <span class="points">Spent (Cost)</span>
            </header>

            <ol class="skills-list">
                {{#each category.skills as |skill skillId|}}
                <li class="skill flexrow {{skill.css}}" data-skill="{{skillId}}">
                    <div class="skill-name flexrow">
                        <img class="skill-icon" title="{{skill.name}}" src="{{skill.icon}}"/>
                        <h4><a class="control" title="Roll Check" data-action="skillRoll">{{skill.name}}</a></h4>
                        <a class="control skill-config" title="Configure Skill" data-action="skillConfig">
                            <i class="fas fa-cog"></i>
                        </a>
                    </div>
                    <div class="bonus flexrow">
                        <span class="active highlight tooltipped">
                            {{numberFormat skill.score sign=true}}
                            <div class="tooltip">{{skill.tooltips.value}}</div>
                        </span>
                        <span class="passive tooltipped">
                            ({{skill.passive}})
                            <div class="tooltip">{{skill.tooltips.passive}}</div>
                        </span>
                    </div>
                    <div class="attributes">
                        {{#each skill.attributes}}
                        <span class="attribute tag">{{this.abbreviation}}</span>
                        {{/each}}
                    </div>
                    <span class="rank">
                        <div class="skill-ranks tooltipped">
                            {{#each skill.pips}}
                            <span class="pip {{this}}"></span>
                            {{/each}}
                            <div class="tooltip">{{skill.rankName}}, {{skill.pathName}}</div>
                        </div>
                    </span>
                    <div class="points flexrow">
                        <a class="control {{#unless skill.canDecrease}}inactive{{/unless}} decrease" title="Decrease Skill Rank" data-action="skillDecrease">
                            <i class="fas fa-caret-down"></i>
                        </a>
                        <span class="cumulative">{{skill.spent}}</span>
                        <span class="next">{{#if skill.cost}}({{skill.cost}}){{else}}-{{/if}}</span>
                        <a class="control {{#unless skill.canIncrease}}inactive{{/unless}} increase" title="Increase Skill Rank" data-action="skillIncrease">
                            <i class="fas fa-caret-up"></i>
                        </a>
                    </div>
                </li>
                {{/each}}
            </ol>
            {{/each}}
        </div>

        {{!-- Talents Tab --}}
        <div class="tab talents flexcol" data-group="primary" data-tab="talents">
            <div class="point-pools flexrow">
                <a class="button control" data-action="talentTree">{{talentTreeButton}}</a>
                <label>Talent Points</label>
                <span class="value highlight">{{points.talent.total}}</span>
                <label>Spent</label>
                <span class="value highlight">{{points.talent.spent}}</span>
                <label>Available</label>
                <span class="value highlight">{{points.talent.available}}</span>
                <a class="button control reset" data-action="talentReset">Reset</a>
            </div>

            {{#each items.talents as |section s|}}
            {{#if section.items.length}}
            <header class="items-header flexrow">
                <div class="item-name flexrow">
                    <h4>{{section.label}}</h4>
                </div>
            </header>
            <ol class="items-list">
                {{#each section.items as |item id|}}
                <li class="item flexrow {{item.cssClass}}" data-item-id="{{item._id}}">
                    <div class="item-name flexrow">
                        <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                        <h4>{{item.name}}</h4>
                        <div class="tags">
                            {{#each item.tags}}
                            {{#if this}}<span class="tag">{{this}}</span>{{/if}}
                            {{/each}}
                        </div>
                    </div>
                    <div class="item-controls">
                        <a class="control" data-action="itemEdit" title="Edit Item">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a class="control" data-action="itemDelete" title="Delete Item">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </li>
                {{/each}}
            </ol>
            {{/if}}
            {{/each}}
        </div>

        {{!-- Inventory Tab --}}
        <div class="tab inventory flexcol" data-group="primary" data-tab="inventory">
            {{#each items.inventory as |section s|}}
            {{#if section.items.length}}
            <header class="items-header flexrow">
                <div class="item-name flexrow">
                    <h4>{{section.label}}</h4>
                </div>
                <div class="item-controls">
                    <a class="control" data-action="itemCreate"><i class="fas fa-plus"></i></a>
                </div>
            </header>
            <ol class="items-list">
                {{#each section.items as |item id|}}
                <li class="item flexrow {{item.cssClass}}" data-item-id="{{item._id}}">
                    <div class="item-name flexrow">
                        <img src="{{item.img}}" title="{{item.name}}" width="24" height="24"/>
                        <h4>
                            {{#if item.showStack}}<span class="stack">({{item.system.quantity}}) </span>{{/if}}
                            {{~item.name~}}
                        </h4>
                        <div class="tags">
                            {{#each item.tags}}
                            {{#if this}}<span class="tag">{{this}}</span>{{/if}}
                            {{/each}}
                        </div>
                    </div>
                    <div class="item-controls">
                        <a class="control equipped-state" data-action="itemEquip" title="Equip Item">
                            <i class="fas fa-shield-alt"></i>
                        </a>
                        <a class="control" data-action="itemEdit" title="Edit Item">
                            <i class="fas fa-edit"></i>
                        </a>
                        <a class="control" data-action="itemDelete" title="Delete Item">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </li>
                {{/each}}
            </ol>
            {{/if}}
            {{/each}}
        </div>

        {{!-- Grimoire Tab --}}
        <div class="tab spells flexcol" data-group="primary" data-tab="spells">
            <header class="items-header spells-header flexrow">
                <div class="item-name flexrow">
                    <h4>Arcane Runes</h4>
                </div>
                <div class="item-controls">
                    <a class="control" data-action="itemCreate"><i class="fas fa-plus"></i></a>
                </div>
            </header>
            <p class="notes" style="flex: none">No runes known.</p>
            <header class="items-header spells-header flexrow">
                <div class="item-name flexrow">
                    <h4>Spell Gestures</h4>
                </div>
                <div class="item-controls">
                    <a class="control" data-action="itemCreate"><i class="fas fa-plus"></i></a>
                </div>
            </header>
            <p class="notes" style="flex: none">No gestures known.</p>
            <header class="items-header spells-header flexrow">
                <div class="item-name flexrow">
                    <h4>Metamagic Inflections</h4>
                </div>
                <div class="item-controls">
                    <a class="control" data-action="itemCreate"><i class="fas fa-plus"></i></a>
                </div>
            </header>
            <p class="notes" style="flex: none">No inflections known.</p>
        </div>

        {{!-- Biography Tab --}}
        <div class="tab biography flexcol" data-group="primary" data-tab="biography">
            <h2 class="section-header divider"><span></span><label>Public Biography</label><span></span></h2>
            {{editor biography.public target="system.details.biography.public" button=true owner=owner editable=editable}}
            <h2 class="section-header divider"><span></span><label>Private Biography</label><span></span></h2>
            {{editor biography.private target="system.details.biography.private" button=true owner=owner editable=editable}}
        </div>
    </section>
</form>
